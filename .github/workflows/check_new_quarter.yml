name: Check for New Quarter and Update Deployed Terms if needed

on:
    schedule:
        - cron: '0 * * * *'
    workflow_dispatch:
  
env:
    ANTEATER_API_KEY: ${{ secrets.ANTEATER_API_KEY }}

permissions:
    contents: write

jobs:
    check-and-reschedule:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}
            
            - name: Configure Git
              run: |
                  git config user.name "github-actions[bot]"
                  git config user.email "github-actions[bot]@users.noreply.github.com"

            - name: Check for new Terms
              id: check
              run: |
                echo "Fetching latest terms from AnteaterAPI..."
                API_RESPONSE=$(curl -s https://anteaterapi.com/v2/rest/websoc/terms)

                if [ -z "$API_RESPONSE" ]; then
                    echo "Error: AnteaterAPI returned an empty response"
                    exit 1
                fi 

                if ! echo "$API_RESPONSE" | jq empty 2>/dev/null; then
                    echo "Error: AnteaterAPI returned invalid JSON"
                    exit 1
                fi

                



